<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium Anime Admin</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f172a;
  color:white;
}
header{
  background:linear-gradient(90deg,#9333ea,#6366f1);
  padding:15px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}
.container{padding:15px;}
.card{
  background:#1e293b;
  padding:15px;
  margin-bottom:20px;
  border-radius:15px;
}
input{
  width:100%;
  padding:8px;
  margin-bottom:8px;
  border-radius:8px;
  border:none;
}
button{
  padding:7px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  margin-top:5px;
}
.addBtn{background:#22c55e;color:white;}
.deleteBtn{background:#ef4444;color:white;}
.epBtn{background:#3b82f6;color:white;}
select{
  width:100%;
  padding:6px;
  border-radius:6px;
  margin-top:8px;
}
iframe{
  width:100%;
  height:200px;
  margin-top:10px;
  border-radius:10px;
}
</style>
</head>

<body>

<header>ðŸ”¥ Premium Anime Admin Panel</header>

<div class="container">

<h3>Add New Anime</h3>
<input type="text" id="title" placeholder="Anime Title">
<button class="addBtn" onclick="addAnime()">Add Anime</button>

<hr>

<div id="animeList"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_hLvrqWjOMkuYxLv3nYz2w_3K6-te5l8",
  authDomain: "sohan-b3d3e.firebaseapp.com",
  projectId: "sohan-b3d3e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.addAnime = async function(){
  let title=document.getElementById("title").value;
  if(title==""){ alert("Enter title"); return; }

  await addDoc(collection(db,"anime"),{
    title:title,
    episodes:[]
  });

  document.getElementById("title").value="";
  loadAnime();
}

async function loadAnime(){
  const querySnapshot=await getDocs(collection(db,"anime"));
  let container=document.getElementById("animeList");
  container.innerHTML="";

  querySnapshot.forEach(docSnap=>{
    let data=docSnap.data();
    let id=docSnap.id;

    let div=document.createElement("div");
    div.className="card";

    let options="";
    if(data.episodes){
      data.episodes.forEach((ep,i)=>{
        options+=`<option value="${ep}">Episode ${i+1}</option>`;
      });
    }

    div.innerHTML=`
      <h3>${data.title}</h3>

      <input type="text" placeholder="New Episode Link" id="ep-${id}">
      <button class="epBtn" onclick="addEpisode('${id}')">Add Episode</button>

      <select onchange="playEpisode(this)">
        <option>Select Episode</option>
        ${options}
      </select>

      <iframe></iframe>
      <br>
      <button class="deleteBtn" onclick="deleteAnime('${id}')">Delete Anime</button>
    `;

    container.appendChild(div);
  });
}

window.addEpisode = async function(id){
  let input=document.getElementById("ep-"+id);
  let link=input.value;
  if(link==""){ alert("Enter episode link"); return; }

  const querySnapshot=await getDocs(collection(db,"anime"));
  querySnapshot.forEach(async docSnap=>{
    if(docSnap.id==id){
      let data=docSnap.data();
      let episodes=data.episodes || [];
      episodes.push(link);
      await updateDoc(doc(db,"anime",id),{
        episodes:episodes
      });
    }
  });

  input.value="";
  loadAnime();
}

window.playEpisode=function(select){
  let iframe=select.parentElement.querySelector("iframe");
  iframe.src=select.value;
}

window.deleteAnime=async function(id){
  await deleteDoc(doc(db,"anime",id));
  loadAnime();
}

loadAnime();

</script>

</body>
</html>
