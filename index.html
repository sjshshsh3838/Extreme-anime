<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”¥ YOUR REAL FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyC_hLvrqWjOMkuYxLv3nYz2w_3K6-te5l8",
  authDomain: "sohan-b3d3e.firebaseapp.com",
  projectId: "sohan-b3d3e",
  storageBucket: "sohan-b3d3e.firebasestorage.app",
  messagingSenderId: "30321240527",
  appId: "1:30321240527:web:ff4e862bb31f1a8bcb8aba",
  measurementId: "G-NVNSRLQ3J7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ADD EPISODE */
window.addEpisode = async function(){
let title=document.getElementById("title").value;
let image=document.getElementById("image").value;
let epname=document.getElementById("epname").value;
let eplink=document.getElementById("eplink").value;

if(!title||!image||!epname||!eplink){
alert("Fill all fields");
return;
}

await addDoc(collection(db,"anime"),{
title,image,epname,eplink
});

alert("Episode Added!");
location.reload();
}

/* LOAD ANIME */
async function loadAnime(){
const querySnapshot = await getDocs(collection(db,"anime"));
let container=document.getElementById("animeList");
container.innerHTML="";

querySnapshot.forEach(documentSnapshot=>{
let data=documentSnapshot.data();
let id=documentSnapshot.id;

let card=document.createElement("div");
card.className="card";

card.innerHTML=`
<img src="${data.image}">
<h3>${data.title}</h3>

<select onchange="playVideo(this)">
<option value="">Select Episode</option>
<option value="${data.eplink}">${data.epname}</option>
</select>

<button class="delete" onclick="deleteAnime('${id}')">Delete</button>
`;

container.appendChild(card);
});
}

/* DELETE */
window.deleteAnime=async function(id){
if(confirm("Delete this anime?")){
await deleteDoc(doc(db,"anime",id));
alert("Deleted!");
location.reload();
}
}

/* VIDEO PLAYER */
window.playVideo=function(select){
let link=select.value;
if(!link)return;

document.getElementById("player").style.display="block";
document.getElementById("videoFrame").src=link;
}

window.closePlayer=function(){
document.getElementById("player").style.display="none";
document.getElementById("videoFrame").src="";
}

loadAnime();

</script>
